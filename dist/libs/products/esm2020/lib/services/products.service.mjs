import { Inject, Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
let categoryMap = new Map();
let brandMap = new Map();
export class ProductsService {
    constructor(http, environment) {
        this.http = http;
        this.environment = environment;
        this.apiUrlProducts = this.environment.apiURL + 'products';
        categoryMap.set("camicie", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("camice", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("polo", "61abf4a257450fc2517488f0");
        categoryMap.set("pantaloni", "61b631af0d7e33d82b524c10");
        categoryMap.set("giacche", "61bdddff2ddc4a8c13df4a17");
        categoryMap.set("felpe", "61bdf809872350f840c8979d");
        categoryMap.set("felpa", "61bdf809872350f840c8979d");
        categoryMap.set("maglioni", "61e1a62d81572bb64bd8d73b");
        categoryMap.set("gilet", "61e7cdc42eedad9135296d50");
        categoryMap.set("sneakers", "624ac34e9a3fb4d0bf04edd2");
        categoryMap.set("t-shirt", "624ac784503abba399845265");
        categoryMap.set("t-shirt ml", "624ac784503abba399845265");
        categoryMap.set("giubbotti", "624ac7f7503abba39984526d");
        categoryMap.set("giubbotto", "624ac7f7503abba39984526d");
        categoryMap.set("cinture", "632eb741544addd6ea6c2bdd");
        categoryMap.set("scarpe", "632eb754544addd6ea6c2be0");
        categoryMap.set("bermuda", "");
        categoryMap.set("jeans", "632eb762544addd6ea6c2be3");
        brandMap.set("blauer", "6213c7889309de960180da4a");
        brandMap.set("old river", "6213c89e9309de960180da4d");
        brandMap.set("colmar", "62167bd1cba8a1e0d9c1af88");
        brandMap.set("ea7", "62189efe1d62386cc22525b6");
        brandMap.set("fred perry", "62189f1e1d62386cc22525b9");
        brandMap.set("kway", "62189f371d62386cc22525bc");
        brandMap.set("lacoste", "62189f481d62386cc22525bf");
        brandMap.set("murphy&nye", "62189f7d1d62386cc22525c2");
        brandMap.set("peninsula", "62189f981d62386cc22525c5");
        brandMap.set("saucony", "62189fad1d62386cc22525c8");
        brandMap.set("sundek", "62189fbb1d62386cc22525cb");
        brandMap.set("barbour", "632e05f3b8c567de5ea83669");
        brandMap.set("ciesse", "636b57e2506ba65e593baa81");
        brandMap.set("husky", "636b57f3506ba65e593baa84");
        brandMap.set("husky fall", "636b57f3506ba65e593baa84");
        brandMap.set("canadiens", "636b5806506ba65e593baa87");
    }
    // BASIC
    // Get all products in the database - optional category query params
    getProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(this.apiUrlProducts, { params: params });
    }
    getFilteredProducts(brand, category, sex, taglie) {
        console.log("cerco con questi parametri-> brand = " + brand + " caetgory = + " + category + " sex = " + sex);
        let params = new HttpParams();
        if (brand != null && brand[0] != null && brand[0].length <= 9) {
            let objBrand;
            objBrand = [];
            brand.forEach(x => objBrand.push(brandMap.get(x)));
            params = params.append('brand', objBrand.join(','));
            console.log(params);
        }
        if (brand != null && brand[0] != null && brand[0].length > 9) {
            params = params.append('brand', brand.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length <= 9) {
            let objCategory;
            objCategory = [];
            category.forEach(x => objCategory.push(categoryMap.get(x)));
            params = params.append('category', objCategory.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length > 9) {
            params = params.append('category', category.join(','));
            console.log(params);
        }
        if (sex) {
            params = params.append('sex', sex.join(','));
        }
        if (taglie) {
            params = params.append('taglie', taglie.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/filteredProducts`, { params: params });
    }
    // SEX FILTER
    // Get products for men - optional categories query params
    getMProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(`${this.apiUrlProducts}/get/men-prods`, {
            params: params,
        });
    }
    // Get products for women - optional categories query params
    getWProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/get/women-prods`, {
            params: params,
        });
    }
    getAllProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/all`, {
            params: params,
        });
    }
    getAllMProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/men`, {
            params: params,
        });
    }
    getAllWProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/women`, {
            params: params,
        });
    }
    // Get products for men - optional categories & brand query params
    getMproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/men`, {
            params: params,
        });
    }
    // Get products for women - optional categories & brand query params
    getWproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/women`, { params: params });
    }
    // Get all products filtered by brand only.
    getProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/${brandId}`);
    }
    getWProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/women-products/${brandId}`);
    }
    getProduct(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProduct2(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProductByName(prodName) {
        return this.http.get(`${this.apiUrlProducts}/prodname/${prodName}`);
    }
    getProductById(prodId) {
        return this.http.get(`${this.apiUrlProducts}/prodid/${prodId}`);
    }
    createProduct(productData) {
        return this.http.post(this.apiUrlProducts, productData);
    }
    updateProduct(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}`, productData);
    }
    updateProductWithVariant(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}/add/variant`, productData);
    }
    deleteProduct(productId) {
        return this.http.delete(`${this.apiUrlProducts}/${productId}`);
    }
    getProductsCount() {
        return this.http
            .get(`${this.apiUrlProducts}/get/count`)
            .pipe(map((objectValue) => objectValue.productCount));
    }
    getFeaturedProducts() {
        return this.http.get(`${this.apiUrlProducts}/get/featured/`);
    }
    getFeaturedProductsByBrand(brand) {
        return this.http.get(`${this.apiUrlProducts}/get/featured/` + brand);
    }
    addGallery(productId, galleryFormData) {
        console.log("sending post request, adding to gallery!");
        return this.http.post(`${this.apiUrlProducts}/gallery-images/${productId}`, galleryFormData);
    }
}
ProductsService.ɵfac = function ProductsService_Factory(t) { return new (t || ProductsService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject('environment')); };
ProductsService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: ProductsService, factory: ProductsService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(ProductsService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                type: Inject,
                args: ['environment']
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdHMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcHJvZHVjdHMvc3JjL2xpYi9zZXJ2aWNlcy9wcm9kdWN0cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFOUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7QUFHckMsSUFBSSxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFDM0MsSUFBSSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFLeEMsTUFBTSxPQUFPLGVBQWU7SUFLMUIsWUFBb0IsSUFBZ0IsRUFBeUIsV0FBVztRQUFwRCxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO1FBRTNELFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDdkQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN0RCxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3BELFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN2RCxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3JELFdB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QU0sQ0FBTSxHQUFHLElBQUksQ0FBQyxjQUFjLElBQUksU0FBUyxFQUFFLENBQUMsQ0FBQztJQUN0RSxDQUFDO0lBRUQsZ0JBQWdCO1FBQ2QsT0FBTyxJQUFJLENBQUMsSUFBSTthQUNiLEdBQUcsQ0FBUyxHQUFHLElBQUksQ0FBQyxjQUFjLFlBQVksQ0FBQzthQUMvQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsV0FBZ0IsRUFBRSxFQUFFLENBQUMsV0FBVyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVELG1CQUFtQjtRQUNqQixPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFlLEdBQUcsSUFBSSxDQUFDLGNBQWMsZ0JBQWdCLENBQUMsQ0FBQztJQUM3RSxDQUFDO0lBR0QsMEJBQTBCLENBQUMsS0FBWTtRQUNyQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFlLEdBQUcsSUFBSSxDQUFDLGNBQWMsZ0JBQWdCLEdBQUcsS0FBSyxDQUFDLENBQUM7SUFDckYsQ0FBQztJQUdELFVBQVUsQ0FBQyxTQUFpQixFQUFFLGVBQXlCO1FBQ3JELE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztRQUV4RCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLGNBQWMsbUJBQW1CLFNBQVMsRUFBRSxFQUFFLGVBQWUsQ0FBQyxDQUFDO0lBRS9GLENBQUM7OzhFQXhTVSxlQUFlLDBDQUtvQixhQUFhO3FFQUxoRCxlQUFlLFdBQWYsZUFBZSxtQkFGZCxNQUFNO3VGQUVQLGVBQWU7Y0FIM0IsVUFBVTtlQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COztzQkFNd0MsTUFBTTt1QkFBQyxhQUFhIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgeyBJbmplY3QsIEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBQcm9kdWN0MTIzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2R1Y3QxMjMnO1xuXG5sZXQgY2F0ZWdvcnlNYXAgPSBuZXcgTWFwPHN0cmluZyxzdHJpbmc+KCk7XG5sZXQgYnJhbmRNYXAgPSBuZXcgTWFwPHN0cmluZyxzdHJpbmc+KCk7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxufSlcbmV4cG9ydCBjbGFzcyBQcm9kdWN0c1NlcnZpY2Uge1xuICBwcml2YXRlIGVudmlyb25tZW50O1xuICBwcml2YXRlIGFwaVVybFByb2R1Y3RzO1xuXG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBodHRwOiBIdHRwQ2xpZW50LCBASW5qZWN0KCdlbnZpcm9ubWVudCcpIGVudmlyb25tZW50KSB7XG4gICAgdGhpcy5lbnZpcm9ubWVudCA9IGVudmlyb25tZW50O1xuICAgIHRoaXMuYXBpVXJsUHJvZHVjdHMgPSB0aGlzLmVudmlyb25tZW50LmFwaVVSTCArICdwcm9kdWN0cyc7XG5cbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJjYW1pY2llXCIsIFwiNjFhYjdkYmFmNjM2NGUzOGE1YjYyOTdiXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImNhbWljZVwiLCBcIjYxYWI3ZGJhZjYzNjRlMzhhNWI2Mjk3YlwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJwb2xvXCIsIFwiNjFhYmY0YTI1NzQ1MGZjMjUxNzQ4OGYwXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcInBhbnRhbG9uaVwiLCBcIjYxYjYzMWFmMGQ3ZTMzZDgyYjUyNGMxMFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJnaWFjY2hlXCIsIFwiNjFiZGRkZmYyZGRjNGE4YzEzZGY0YTE3XCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImZlbHBlXCIsIFwiNjFiZGY4MDk4NzIzNTBmODQwYzg5NzlkXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImZlbHBhXCIsIFwiNjFiZGY4MDk4NzIzNTBmODQwYzg5NzlkXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcIm1hZ2xpb25pXCIsIFwiNjFlMWE2MmQ4MTU3MmJiNjRiZDhkNzNiXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImdpbGV0XCIsIFwiNjFlN2NkYzQyZWVkYWQ5MTM1Mjk2ZDUwXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcInNuZWFrZXJzXCIsIFwiNjI0YWMzNGU5YTNmYjRkMGJmMDRlZGQyXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcInQtc2hpcnRcIiwgXCI2MjRhYzc4NDUwM2FiYmEzOTk4NDUyNjVcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwidC1zaGlydCBtbFwiLCBcIjYyNGFjNzg0NTAzYWJiYTM5OTg0NTI2NVwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJnaXViYm90dGlcIiwgXCI2MjRhYzdmNzUwM2FiYmEzOTk4NDUyNmRcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2l1YmJvdHRvXCIsIFwiNjI0YWM3Zjc1MDNhYmJhMzk5ODQ1MjZkXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImNpbnR1cmVcIiwgXCI2MzJlYjc0MTU0NGFkZGQ2ZWE2YzJiZGRcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwic2NhcnBlXCIsIFwiNjMyZWI3NTQ1NDRhZGRkNmVhNmMyYmUwXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImJlcm11ZGFcIiwgXCJcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiamVhbnNcIiwgXCI2MzJlYjc2MjU0NGFkZGQ2ZWE2YzJiZTNcIik7XG5cbiAgICBicmFuZE1hcC5zZXQoXCJibGF1ZXJcIiwgXCI2MjEzYzc4ODkzMDlkZTk2MDE4MGRhNGFcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwib2xkIHJpdmVyXCIsIFwiNjIxM2M4OWU5MzA5ZGU5NjAxODBkYTRkXCIpO1xuICAgIGJyYW5kTWFwLnNldChcImNvbG1hclwiLCBcIjYyMTY3YmQxY2JhOGExZTBkOWMxYWY4OFwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJlYTdcIiwgXCI2MjE4OWVmZTFkNjIzODZjYzIyNTI1YjZcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiZnJlZCBwZXJyeVwiLFwiNjIxODlmMWUxZDYyMzg2Y2MyMjUyNWI5XCIpO1xuICAgIGJyYW5kTWFwLnNldChcImt3YXlcIiwgXCI2MjE4OWYzNzFkNjIzODZjYzIyNTI1YmNcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwibGFjb3N0ZVwiLFwiNjIxODlmNDgxZDYyMzg2Y2MyMjUyNWJmXCIpO1xuICAgIGJyYW5kTWFwLnNldChcIm11cnBoeSZueWVcIixcIjYyMTg5ZjdkMWQ2MjM4NmNjMjI1MjVjMlwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJwZW5pbnN1bGFcIiwgXCI2MjE4OWY5ODFkNjIzODZjYzIyNTI1YzVcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwic2F1Y29ueVwiLCBcIjYyMTg5ZmFkMWQ2MjM4NmNjMjI1MjVjOFwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJzdW5kZWtcIiwgXCI2MjE4OWZiYjFkNjIzODZjYzIyNTI1Y2JcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiYmFyYm91clwiLCBcIjYzMmUwNWYzYjhjNTY3ZGU1ZWE4MzY2OVwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJjaWVzc2VcIiwgXCI2MzZiNTdlMjUwNmJhNjVlNTkzYmFhODFcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiaHVza3lcIiwgXCI2MzZiNTdmMzUwNmJhNjVlNTkzYmFhODRcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiaHVza3kgZmFsbFwiLCBcIjYzNmI1N2YzNTA2YmE2NWU1OTNiYWE4NFwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJjYW5hZGllbnNcIiwgXCI2MzZiNTgwNjUwNmJhNjVlNTkzYmFhODdcIik7XG4gIH1cblxuICAvLyBCQVNJQ1xuXG4gIC8vIEdldCBhbGwgcHJvZHVjdHMgaW4gdGhlIGRhdGFiYXNlIC0gb3B0aW9uYWwgY2F0ZWdvcnkgcXVlcnkgcGFyYW1zXG5cbiAgZ2V0UHJvZHVjdHMoY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoY2F0ZWdvcmllc0ZpbHRlcikge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4odGhpcy5hcGlVcmxQcm9kdWN0cywgeyBwYXJhbXM6IHBhcmFtcyB9KTtcbiAgfVxuXG5cblxuICBnZXRGaWx0ZXJlZFByb2R1Y3RzKGJyYW5kPzogc3RyaW5nIFtdLCBjYXRlZ29yeT86c3RyaW5nW10sIHNleD86IHN0cmluZ1tdLCB0YWdsaWU/OiBzdHJpbmdbXSk6IE9ic2VydmFibGU8UHJvZHVjdDEyM1tdPiB7XG5cbiAgICBcbiAgICBjb25zb2xlLmxvZyhcImNlcmNvIGNvbiBxdWVzdGkgcGFyYW1ldHJpLT4gYnJhbmQgPSBcIiArIGJyYW5kICsgXCIgY2FldGdvcnkgPSArIFwiICsgY2F0ZWdvcnkgKyBcIiBzZXggPSBcIiArIHNleClcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoYnJhbmQgIT0gbnVsbCAmJiBicmFuZFswXSE9IG51bGwgJiYgYnJhbmRbMF0ubGVuZ3RoIDw9IDkpIHtcbiAgICAgIGxldCBvYmpCcmFuZDogc3RyaW5nW11cbiAgICAgIG9iakJyYW5kID0gW107XG5cbiAgICAgIGJyYW5kLmZvckVhY2goeCA9PiBvYmpCcmFuZC5wdXNoKGJyYW5kTWFwLmdldCh4KSkpO1xuXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIG9iakJyYW5kLmpvaW4oJywnKSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuICAgIGlmIChicmFuZCAhPSBudWxsICYmIGJyYW5kWzBdIT0gbnVsbCAmJiBicmFuZFswXS5sZW5ndGggPiA5KSB7XG4gICAgICBcblxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZC5qb2luKCcsJykpO1xuICAgIFxuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcbiAgICB9XG5cbiAgICBpZiAoY2F0ZWdvcnkgIT0gbnVsbCAmJiBjYXRlZ29yeVswXSE9IG51bGwgJiYgY2F0ZWdvcnlbMF0ubGVuZ3RoIDw9IDkpIHtcbiAgICAgIGxldCBvYmpDYXRlZ29yeTogc3RyaW5nW11cbiAgICAgIG9iakNhdGVnb3J5ID0gW107XG5cbiAgICAgIGNhdGVnb3J5LmZvckVhY2goeCA9PiBvYmpDYXRlZ29yeS5wdXNoKGNhdGVnb3J5TWFwLmdldCh4KSkpO1xuXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yeScsIG9iakNhdGVnb3J5LmpvaW4oJywnKSk7XG4gICAgXG4gICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xuICAgIH1cblxuICAgIGlmIChjYXRlZ29yeSAhPSBudWxsICYmIGNhdGVnb3J5WzBdIT0gbnVsbCAmJiBjYXRlZ29yeVswXS5sZW5ndGggPiA5KSB7XG4gICAgICBcblxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcnknLCBjYXRlZ29yeS5qb2luKCcsJykpO1xuICAgIFxuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcbiAgICB9XG5cbiAgICBpZihzZXgpe1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnc2V4Jywgc2V4LmpvaW4oJywnKSk7XG4gICAgfVxuXG4gICAgaWYodGFnbGllKXtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ3RhZ2xpZScsIHRhZ2xpZS5qb2luKCcsJykpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZmlsdGVyZWRQcm9kdWN0c2AsIHsgcGFyYW1zOiBwYXJhbXMgfSk7XG4gIH1cblxuXG5cblxuICAvLyBTRVggRklMVEVSXG5cbiAgLy8gR2V0IHByb2R1Y3RzIGZvciBtZW4gLSBvcHRpb25hbCBjYXRlZ29yaWVzIHF1ZXJ5IHBhcmFtc1xuXG4gIGdldE1Qcm9kdWN0cyhjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGlmIChjYXRlZ29yaWVzRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yaWVzJywgY2F0ZWdvcmllc0ZpbHRlci5qb2luKCcsJykpO1xuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvbWVuLXByb2RzYCwge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgfSk7XG4gIH1cblxuICAvLyBHZXQgcHJvZHVjdHMgZm9yIHdvbWVuIC0gb3B0aW9uYWwgY2F0ZWdvcmllcyBxdWVyeSBwYXJhbXNcblxuICBnZXRXUHJvZHVjdHMoY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2NhdGVnb3JpZXMnLCBjYXRlZ29yaWVzRmlsdGVyLmpvaW4oJywnKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L3dvbWVuLXByb2RzYCwge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgfSk7XG4gIH1cblxuICBnZXRBbGxQcm9kdWN0c0J5QnJhbmQoYnJhbmRGaWx0ZXI/OiBzdHJpbmcpIHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoYnJhbmRGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2JyYW5kJywgYnJhbmRGaWx0ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9icmFuZC9hbGxgLCB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICB9KTtcbiAgfVxuXG4gIGdldEFsbE1Qcm9kdWN0c0J5QnJhbmQoYnJhbmRGaWx0ZXI/OiBzdHJpbmcpIHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoYnJhbmRGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2JyYW5kJywgYnJhbmRGaWx0ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9icmFuZC9tZW5gLCB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICB9KTtcbiAgfVxuICBnZXRBbGxXUHJvZHVjdHNCeUJyYW5kKGJyYW5kRmlsdGVyPzogc3RyaW5nKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQvd29tZW5gLCB7XG4gICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEdldCBwcm9kdWN0cyBmb3IgbWVuIC0gb3B0aW9uYWwgY2F0ZWdvcmllcyAmIGJyYW5kIHF1ZXJ5IHBhcmFtc1xuXG4gIGdldE1wcm9kdWN0c0ZpbHRlcmVkQnlDYXRlZ29yeUFuZEJyYW5kKFxuICAgIGNhdGVnb3JpZXNGaWx0ZXI/OiBzdHJpbmdbXSxcbiAgICBicmFuZEZpbHRlcj86IHN0cmluZ1xuICApIHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoY2F0ZWdvcmllc0ZpbHRlcikge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcbiAgICB9XG5cbiAgICBpZiAoYnJhbmRGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2JyYW5kJywgYnJhbmRGaWx0ZXIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2JyYW5kLWFuZC1jYXRlZ29yeS9tZW5gLFxuICAgICAge1xuICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLy8gR2V0IHByb2R1Y3RzIGZvciB3b21lbiAtIG9wdGlvbmFsIGNhdGVnb3JpZXMgJiBicmFuZCBxdWVyeSBwYXJhbXNcblxuICBnZXRXcHJvZHVjdHNGaWx0ZXJlZEJ5Q2F0ZWdvcnlBbmRCcmFuZChcbiAgICBjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10sXG4gICAgYnJhbmRGaWx0ZXI/OiBzdHJpbmdcbiAgKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2NhdGVnb3JpZXMnLCBjYXRlZ29yaWVzRmlsdGVyLmpvaW4oJywnKSk7XG4gICAgfVxuXG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihcbiAgICAgIGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9icmFuZC1hbmQtY2F0ZWdvcnkvd29tZW5gLFxuICAgICAgeyBwYXJhbXM6IHBhcmFtcyB9XG4gICAgKTtcbiAgfVxuXG4gIC8vIEdldCBhbGwgcHJvZHVjdHMgZmlsdGVyZWQgYnkgYnJhbmQgb25seS5cblxuICBnZXRQcm9kdWN0c0J5QnJhbmQoYnJhbmRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2JyYW5kLyR7YnJhbmRJZH1gKTtcbiAgfVxuXG4gIGdldFdQcm9kdWN0c0J5QnJhbmQoYnJhbmRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vYnJhbmQvd29tZW4tcHJvZHVjdHMvJHticmFuZElkfWBcbiAgICApO1xuICB9XG5cbiAgZ2V0UHJvZHVjdChwcm9kdWN0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8UHJvZHVjdDEyMz4ge1xuICAgIGxldCByZXNwb25zZSA9IHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyMz4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0SWR9YCk7XG4gICAgcmV0dXJuIHJlc3BvbnNlXG4gIH1cblxuICBnZXRQcm9kdWN0Mihwcm9kdWN0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XG4gICAgbGV0IHJlc3BvbnNlID0gdGhpcy5odHRwLmdldDxhbnk+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdElkfWApO1xuICAgIHJldHVybiByZXNwb25zZVxuICB9XG5cblxuICBnZXRQcm9kdWN0QnlOYW1lKHByb2ROYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9wcm9kbmFtZS8ke3Byb2ROYW1lfWBcbiAgICApO1xuICB9XG5cbiAgZ2V0UHJvZHVjdEJ5SWQocHJvZElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9wcm9kaWQvJHtwcm9kSWR9YFxuICAgICk7XG4gIH1cblxuICBjcmVhdGVQcm9kdWN0KHByb2R1Y3REYXRhOiBGb3JtRGF0YSk6IE9ic2VydmFibGU8UHJvZHVjdDEyMz4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxQcm9kdWN0MTIzPih0aGlzLmFwaVVybFByb2R1Y3RzLCBwcm9kdWN0RGF0YSk7XG4gIH1cblxuICB1cGRhdGVQcm9kdWN0KHByb2R1Y3REYXRhOiBGb3JtRGF0YSwgcHJvZHVjdGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxQcm9kdWN0MTIzPihcbiAgICAgIGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdGlkfWAsXG4gICAgICBwcm9kdWN0RGF0YVxuICAgICk7XG4gIH1cblxuICB1cGRhdGVQcm9kdWN0V2l0aFZhcmlhbnQoXG4gICAgcHJvZHVjdERhdGE6IEZvcm1EYXRhLFxuICAgIHByb2R1Y3RpZDogc3RyaW5nXG4gICk6IE9ic2VydmFibGU8UHJvZHVjdDEyMz4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAucHV0PFByb2R1Y3QxMjM+KFxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0aWR9L2FkZC92YXJpYW50YCxcbiAgICAgIHByb2R1Y3REYXRhXG4gICAgKTtcbiAgfVxuXG4gIGRlbGV0ZVByb2R1Y3QocHJvZHVjdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlPGFueT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0SWR9YCk7XG4gIH1cblxuICBnZXRQcm9kdWN0c0NvdW50KCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cFxuICAgICAgLmdldDxudW1iZXI+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9jb3VudGApXG4gICAgICAucGlwZShtYXAoKG9iamVjdFZhbHVlOiBhbnkpID0+IG9iamVjdFZhbHVlLnByb2R1Y3RDb3VudCkpO1xuICB9XG5cbiAgZ2V0RmVhdHVyZWRQcm9kdWN0cygpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2ZlYXR1cmVkL2ApO1xuICB9XG5cblxuICBnZXRGZWF0dXJlZFByb2R1Y3RzQnlCcmFuZChicmFuZDpzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2ZlYXR1cmVkL2AgKyBicmFuZCk7XG4gIH1cblxuXG4gIGFkZEdhbGxlcnkocHJvZHVjdElkOiBzdHJpbmcsIGdhbGxlcnlGb3JtRGF0YTogRm9ybURhdGEpIDogT2JzZXJ2YWJsZTxhbnk+e1xuICAgIGNvbnNvbGUubG9nKFwic2VuZGluZyBwb3N0IHJlcXVlc3QsIGFkZGluZyB0byBnYWxsZXJ5IVwiKTtcblxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdChgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nYWxsZXJ5LWltYWdlcy8ke3Byb2R1Y3RJZH1gLCBnYWxsZXJ5Rm9ybURhdGEpO1xuXG4gIH1cbn1cbiJdfQ==