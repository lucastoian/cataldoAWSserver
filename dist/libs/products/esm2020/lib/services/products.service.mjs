import { Inject, Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
let categoryMap = new Map();
let brandMap = new Map();
export class ProductsService {
    constructor(http, environment) {
        this.http = http;
        this.environment = environment;
        this.apiUrlProducts = this.environment.apiURL + 'products';
        categoryMap.set("camicie", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("camice", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("polo", "61abf4a257450fc2517488f0");
        categoryMap.set("pantaloni", "61b631af0d7e33d82b524c10");
        categoryMap.set("giacche", "61bdddff2ddc4a8c13df4a17");
        categoryMap.set("felpe", "61bdf809872350f840c8979d");
        categoryMap.set("felpa", "61bdf809872350f840c8979d");
        categoryMap.set("maglioni", "61e1a62d81572bb64bd8d73b");
        categoryMap.set("gilet", "61e7cdc42eedad9135296d50");
        categoryMap.set("sneakers", "624ac34e9a3fb4d0bf04edd2");
        categoryMap.set("t-shirt", "624ac784503abba399845265");
        categoryMap.set("t-shirt ml", "624ac784503abba399845265");
        categoryMap.set("giubbotti", "624ac7f7503abba39984526d");
        categoryMap.set("giubbotto", "624ac7f7503abba39984526d");
        categoryMap.set("cinture", "632eb741544addd6ea6c2bdd");
        categoryMap.set("scarpe", "632eb754544addd6ea6c2be0");
        categoryMap.set("bermuda", "");
        categoryMap.set("jeans", "632eb762544addd6ea6c2be3");
        brandMap.set("blauer", "6213c7889309de960180da4a");
        brandMap.set("old river", "6213c89e9309de960180da4d");
        brandMap.set("colmar", "62167bd1cba8a1e0d9c1af88");
        brandMap.set("ea7", "62189efe1d62386cc22525b6");
        brandMap.set("fred perry", "62189f1e1d62386cc22525b9");
        brandMap.set("kway", "62189f371d62386cc22525bc");
        brandMap.set("lacoste", "62189f481d62386cc22525bf");
        brandMap.set("murphy&nye", "62189f7d1d62386cc22525c2");
        brandMap.set("peninsula", "62189f981d62386cc22525c5");
        brandMap.set("saucony", "62189fad1d62386cc22525c8");
        brandMap.set("sundek", "62189fbb1d62386cc22525cb");
        brandMap.set("barbour", "632e05f3b8c567de5ea83669");
        brandMap.set("ciesse", "636b57e2506ba65e593baa81");
        brandMap.set("husky", "636b57f3506ba65e593baa84");
        brandMap.set("husky fall", "636b57f3506ba65e593baa84");
        brandMap.set("canadiens", "636b5806506ba65e593baa87");
    }
    // BASIC
    // Get all products in the database - optional category query params
    getProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(this.apiUrlProducts, { params: params });
    }
    getFilteredProducts(brand, category, sex, taglie) {
        console.log("cerco con questi parametri-> brand = " + brand + " caetgory = + " + category + " sex = " + sex);
        let params = new HttpParams();
        if (brand != null && brand[0] != null && brand[0].length <= 9) {
            let objBrand;
            objBrand = [];
            brand.forEach(x => objBrand.push(brandMap.get(x)));
            params = params.append('brand', objBrand.join(','));
            console.log(params);
        }
        if (brand != null && brand[0] != null && brand[0].length > 9) {
            params = params.append('brand', brand.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length <= 9) {
            let objCategory;
            objCategory = [];
            category.forEach(x => objCategory.push(categoryMap.get(x)));
            params = params.append('category', objCategory.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length > 9) {
            params = params.append('category', category.join(','));
            console.log(params);
        }
        if (sex) {
            params = params.append('sex', sex.join(','));
        }
        if (taglie) {
            params = params.append('taglie', taglie.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/filteredProducts`, { params: params });
    }
    // SEX FILTER
    // Get products for men - optional categories query params
    getMProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(`${this.apiUrlProducts}/get/men-prods`, {
            params: params,
        });
    }
    // Get products for women - optional categories query params
    getWProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/get/women-prods`, {
            params: params,
        });
    }
    getAllProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/all`, {
            params: params,
        });
    }
    getAllMProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/men`, {
            params: params,
        });
    }
    getAllWProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/women`, {
            params: params,
        });
    }
    // Get products for men - optional categories & brand query params
    getMproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/men`, {
            params: params,
        });
    }
    // Get products for women - optional categories & brand query params
    getWproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/women`, { params: params });
    }
    // Get all products filtered by brand only.
    getProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/${brandId}`);
    }
    getWProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/women-products/${brandId}`);
    }
    getProduct(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProduct2(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProductByName(prodName) {
        return this.http.get(`${this.apiUrlProducts}/prodname/${prodName}`);
    }
    createProduct(productData) {
        return this.http.post(this.apiUrlProducts, productData);
    }
    updateProduct(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}`, productData);
    }
    updateProductWithVariant(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}/add/variant`, productData);
    }
    deleteProduct(productId) {
        return this.http.delete(`${this.apiUrlProducts}/${productId}`);
    }
    getProductsCount() {
        return this.http
            .get(`${this.apiUrlProducts}/get/count`)
            .pipe(map((objectValue) => objectValue.productCount));
    }
    getFeaturedProducts() {
        return this.http.get(`${this.apiUrlProducts}/get/featured/`);
    }
    getFeaturedProductsByBrand(brand) {
        return this.http.get(`${this.apiUrlProducts}/get/featured/` + brand);
    }
    addGallery(productId, galleryFormData) {
        console.log("sending post request, adding to gallery!");
        return this.http.post(`${this.apiUrlProducts}/gallery-images/${productId}`, galleryFormData);
    }
}
ProductsService.ɵfac = function ProductsService_Factory(t) { return new (t || ProductsService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject('environment')); };
ProductsService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: ProductsService, factory: ProductsService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(ProductsService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                type: Inject,
                args: ['environment']
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdHMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcHJvZHVjdHMvc3JjL2xpYi9zZXJ2aWNlcy9wcm9kdWN0cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFOUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7QUFHckMsSUFBSSxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFDM0MsSUFBSSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFLeEMsTUFBTSxPQUFPLGVBQWU7SUFLMUIsWUFBb0IsSUFBZ0IsRUFBeUIsV0FBVztRQUFwRCxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO1FBRTNELFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDdkQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN0RCxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3BELFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN2RCxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3JELFdB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QUcsSUFBSSxDQUFDLGNBQWMsWUFBWSxDQUFDO2FBQy9DLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFnQixFQUFFLEVBQUUsQ0FBQyxXQUFXLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsbUJBQW1CO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQWUsR0FBRyxJQUFJLENBQUMsY0FBYyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzdFLENBQUM7SUFHRCwwQkFBMEIsQ0FBQyxLQUFZO1FBQ3JDLE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQWUsR0FBRyxJQUFJLENBQUMsY0FBYyxnQkFBZ0IsR0FBRyxLQUFLLENBQUMsQ0FBQztJQUNyRixDQUFDO0lBR0QsVUFBVSxDQUFDLFNBQWlCLEVBQUUsZUFBeUI7UUFDckQsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsQ0FBQyxDQUFDO1FBRXhELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsY0FBYyxtQkFBbUIsU0FBUyxFQUFFLEVBQUUsZUFBZSxDQUFDLENBQUM7SUFFL0YsQ0FBQzs7OEVBbFNVLGVBQWUsMENBS29CLGFBQWE7cUVBTGhELGVBQWUsV0FBZixlQUFlLG1CQUZkLE1BQU07dUZBRVAsZUFBZTtjQUgzQixVQUFVO2VBQUM7Z0JBQ1YsVUFBVSxFQUFFLE1BQU07YUFDbkI7O3NCQU13QyxNQUFNO3VCQUFDLGFBQWEiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XHJcbmltcG9ydCB7IEh0dHBDbGllbnQsIEh0dHBQYXJhbXMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XHJcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcclxuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xyXG5pbXBvcnQgeyBQcm9kdWN0MTIzIH0gZnJvbSAnLi4vbW9kZWxzL3Byb2R1Y3QxMjMnO1xyXG5cclxubGV0IGNhdGVnb3J5TWFwID0gbmV3IE1hcDxzdHJpbmcsc3RyaW5nPigpO1xyXG5sZXQgYnJhbmRNYXAgPSBuZXcgTWFwPHN0cmluZyxzdHJpbmc+KCk7XHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnLFxyXG59KVxyXG5leHBvcnQgY2xhc3MgUHJvZHVjdHNTZXJ2aWNlIHtcclxuICBwcml2YXRlIGVudmlyb25tZW50O1xyXG4gIHByaXZhdGUgYXBpVXJsUHJvZHVjdHM7XHJcblxyXG5cclxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGh0dHA6IEh0dHBDbGllbnQsIEBJbmplY3QoJ2Vudmlyb25tZW50JykgZW52aXJvbm1lbnQpIHtcclxuICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudDtcclxuICAgIHRoaXMuYXBpVXJsUHJvZHVjdHMgPSB0aGlzLmVudmlyb25tZW50LmFwaVVSTCArICdwcm9kdWN0cyc7XHJcblxyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiY2FtaWNpZVwiLCBcIjYxYWI3ZGJhZjYzNjRlMzhhNWI2Mjk3YlwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcImNhbWljZVwiLCBcIjYxYWI3ZGJhZjYzNjRlMzhhNWI2Mjk3YlwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcInBvbG9cIiwgXCI2MWFiZjRhMjU3NDUwZmMyNTE3NDg4ZjBcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJwYW50YWxvbmlcIiwgXCI2MWI2MzFhZjBkN2UzM2Q4MmI1MjRjMTBcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJnaWFjY2hlXCIsIFwiNjFiZGRkZmYyZGRjNGE4YzEzZGY0YTE3XCIpO1xyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZmVscGVcIiwgXCI2MWJkZjgwOTg3MjM1MGY4NDBjODk3OWRcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJmZWxwYVwiLCBcIjYxYmRmODA5ODcyMzUwZjg0MGM4OTc5ZFwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcIm1hZ2xpb25pXCIsIFwiNjFlMWE2MmQ4MTU3MmJiNjRiZDhkNzNiXCIpO1xyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2lsZXRcIiwgXCI2MWU3Y2RjNDJlZWRhZDkxMzUyOTZkNTBcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJzbmVha2Vyc1wiLCBcIjYyNGFjMzRlOWEzZmI0ZDBiZjA0ZWRkMlwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcInQtc2hpcnRcIiwgXCI2MjRhYzc4NDUwM2FiYmEzOTk4NDUyNjVcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJ0LXNoaXJ0IG1sXCIsIFwiNjI0YWM3ODQ1MDNhYmJhMzk5ODQ1MjY1XCIpO1xyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2l1YmJvdHRpXCIsIFwiNjI0YWM3Zjc1MDNhYmJhMzk5ODQ1MjZkXCIpO1xyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2l1YmJvdHRvXCIsIFwiNjI0YWM3Zjc1MDNhYmJhMzk5ODQ1MjZkXCIpO1xyXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiY2ludHVyZVwiLCBcIjYzMmViNzQxNTQ0YWRkZDZlYTZjMmJkZFwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcInNjYXJwZVwiLCBcIjYzMmViNzU0NTQ0YWRkZDZlYTZjMmJlMFwiKTtcclxuICAgIGNhdGVnb3J5TWFwLnNldChcImJlcm11ZGFcIiwgXCJcIik7XHJcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJqZWFuc1wiLCBcIjYzMmViNzYyNTQ0YWRkZDZlYTZjMmJlM1wiKTtcclxuXHJcbiAgICBicmFuZE1hcC5zZXQoXCJibGF1ZXJcIiwgXCI2MjEzYzc4ODkzMDlkZTk2MDE4MGRhNGFcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJvbGQgcml2ZXJcIiwgXCI2MjEzYzg5ZTkzMDlkZTk2MDE4MGRhNGRcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJjb2xtYXJcIiwgXCI2MjE2N2JkMWNiYThhMWUwZDljMWFmODhcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJlYTdcIiwgXCI2MjE4OWVmZTFkNjIzODZjYzIyNTI1YjZcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJmcmVkIHBlcnJ5XCIsXCI2MjE4OWYxZTFkNjIzODZjYzIyNTI1YjlcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJrd2F5XCIsIFwiNjIxODlmMzcxZDYyMzg2Y2MyMjUyNWJjXCIpO1xyXG4gICAgYnJhbmRNYXAuc2V0KFwibGFjb3N0ZVwiLFwiNjIxODlmNDgxZDYyMzg2Y2MyMjUyNWJmXCIpO1xyXG4gICAgYnJhbmRNYXAuc2V0KFwibXVycGh5Jm55ZVwiLFwiNjIxODlmN2QxZDYyMzg2Y2MyMjUyNWMyXCIpO1xyXG4gICAgYnJhbmRNYXAuc2V0KFwicGVuaW5zdWxhXCIsIFwiNjIxODlmOTgxZDYyMzg2Y2MyMjUyNWM1XCIpO1xyXG4gICAgYnJhbmRNYXAuc2V0KFwic2F1Y29ueVwiLCBcIjYyMTg5ZmFkMWQ2MjM4NmNjMjI1MjVjOFwiKTtcclxuICAgIGJyYW5kTWFwLnNldChcInN1bmRla1wiLCBcIjYyMTg5ZmJiMWQ2MjM4NmNjMjI1MjVjYlwiKTtcclxuICAgIGJyYW5kTWFwLnNldChcImJhcmJvdXJcIiwgXCI2MzJlMDVmM2I4YzU2N2RlNWVhODM2NjlcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJjaWVzc2VcIiwgXCI2MzZiNTdlMjUwNmJhNjVlNTkzYmFhODFcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJodXNreVwiLCBcIjYzNmI1N2YzNTA2YmE2NWU1OTNiYWE4NFwiKTtcclxuICAgIGJyYW5kTWFwLnNldChcImh1c2t5IGZhbGxcIiwgXCI2MzZiNTdmMzUwNmJhNjVlNTkzYmFhODRcIik7XHJcbiAgICBicmFuZE1hcC5zZXQoXCJjYW5hZGllbnNcIiwgXCI2MzZiNTgwNjUwNmJhNjVlNTkzYmFhODdcIik7XHJcbiAgfVxyXG5cclxuICAvLyBCQVNJQ1xyXG5cclxuICAvLyBHZXQgYWxsIHByb2R1Y3RzIGluIHRoZSBkYXRhYmFzZSAtIG9wdGlvbmFsIGNhdGVnb3J5IHF1ZXJ5IHBhcmFtc1xyXG5cclxuICBnZXRQcm9kdWN0cyhjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xyXG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XHJcbiAgICBpZiAoY2F0ZWdvcmllc0ZpbHRlcikge1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yaWVzJywgY2F0ZWdvcmllc0ZpbHRlci5qb2luKCcsJykpO1xyXG4gICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPih0aGlzLmFwaVVybFByb2R1Y3RzLCB7IHBhcmFtczogcGFyYW1zIH0pO1xyXG4gIH1cclxuXHJcblxyXG5cclxuICBnZXRGaWx0ZXJlZFByb2R1Y3RzKGJyYW5kPzogc3RyaW5nIFtdLCBjYXRlZ29yeT86c3RyaW5nW10sIHNleD86IHN0cmluZ1tdLCB0YWdsaWU/OiBzdHJpbmdbXSk6IE9ic2VydmFibGU8UHJvZHVjdDEyM1tdPiB7XHJcblxyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhcImNlcmNvIGNvbiBxdWVzdGkgcGFyYW1ldHJpLT4gYnJhbmQgPSBcIiArIGJyYW5kICsgXCIgY2FldGdvcnkgPSArIFwiICsgY2F0ZWdvcnkgKyBcIiBzZXggPSBcIiArIHNleClcclxuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xyXG4gICAgaWYgKGJyYW5kICE9IG51bGwgJiYgYnJhbmRbMF0hPSBudWxsICYmIGJyYW5kWzBdLmxlbmd0aCA8PSA5KSB7XHJcbiAgICAgIGxldCBvYmpCcmFuZDogc3RyaW5nW11cclxuICAgICAgb2JqQnJhbmQgPSBbXTtcclxuXHJcbiAgICAgIGJyYW5kLmZvckVhY2goeCA9PiBvYmpCcmFuZC5wdXNoKGJyYW5kTWFwLmdldCh4KSkpO1xyXG5cclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBvYmpCcmFuZC5qb2luKCcsJykpO1xyXG5cclxuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcclxuICAgIH1cclxuICAgIGlmIChicmFuZCAhPSBudWxsICYmIGJyYW5kWzBdIT0gbnVsbCAmJiBicmFuZFswXS5sZW5ndGggPiA5KSB7XHJcbiAgICAgIFxyXG5cclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZC5qb2luKCcsJykpO1xyXG4gICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNhdGVnb3J5ICE9IG51bGwgJiYgY2F0ZWdvcnlbMF0hPSBudWxsICYmIGNhdGVnb3J5WzBdLmxlbmd0aCA8PSA5KSB7XHJcbiAgICAgIGxldCBvYmpDYXRlZ29yeTogc3RyaW5nW11cclxuICAgICAgb2JqQ2F0ZWdvcnkgPSBbXTtcclxuXHJcbiAgICAgIGNhdGVnb3J5LmZvckVhY2goeCA9PiBvYmpDYXRlZ29yeS5wdXNoKGNhdGVnb3J5TWFwLmdldCh4KSkpO1xyXG5cclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcnknLCBvYmpDYXRlZ29yeS5qb2luKCcsJykpO1xyXG4gICAgXHJcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGNhdGVnb3J5ICE9IG51bGwgJiYgY2F0ZWdvcnlbMF0hPSBudWxsICYmIGNhdGVnb3J5WzBdLmxlbmd0aCA+IDkpIHtcclxuICAgICAgXHJcblxyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yeScsIGNhdGVnb3J5LmpvaW4oJywnKSk7XHJcbiAgICBcclxuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcclxuICAgIH1cclxuXHJcbiAgICBpZihzZXgpe1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdzZXgnLCBzZXguam9pbignLCcpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZih0YWdsaWUpe1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCd0YWdsaWUnLCB0YWdsaWUuam9pbignLCcpKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2ZpbHRlcmVkUHJvZHVjdHNgLCB7IHBhcmFtczogcGFyYW1zIH0pO1xyXG4gIH1cclxuXHJcblxyXG5cclxuXHJcbiAgLy8gU0VYIEZJTFRFUlxyXG5cclxuICAvLyBHZXQgcHJvZHVjdHMgZm9yIG1lbiAtIG9wdGlvbmFsIGNhdGVnb3JpZXMgcXVlcnkgcGFyYW1zXHJcblxyXG4gIGdldE1Qcm9kdWN0cyhjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xyXG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XHJcbiAgICBpZiAoY2F0ZWdvcmllc0ZpbHRlcikge1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yaWVzJywgY2F0ZWdvcmllc0ZpbHRlci5qb2luKCcsJykpO1xyXG4gICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvbWVuLXByb2RzYCwge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0IHByb2R1Y3RzIGZvciB3b21lbiAtIG9wdGlvbmFsIGNhdGVnb3JpZXMgcXVlcnkgcGFyYW1zXHJcblxyXG4gIGdldFdQcm9kdWN0cyhjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10pIHtcclxuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xyXG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L3dvbWVuLXByb2RzYCwge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgZ2V0QWxsUHJvZHVjdHNCeUJyYW5kKGJyYW5kRmlsdGVyPzogc3RyaW5nKSB7XHJcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcclxuICAgIGlmIChicmFuZEZpbHRlcikge1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2JyYW5kL2FsbGAsIHtcclxuICAgICAgcGFyYW1zOiBwYXJhbXMsXHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIGdldEFsbE1Qcm9kdWN0c0J5QnJhbmQoYnJhbmRGaWx0ZXI/OiBzdHJpbmcpIHtcclxuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xyXG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XHJcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2JyYW5kJywgYnJhbmRGaWx0ZXIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQvbWVuYCwge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgIH0pO1xyXG4gIH1cclxuICBnZXRBbGxXUHJvZHVjdHNCeUJyYW5kKGJyYW5kRmlsdGVyPzogc3RyaW5nKSB7XHJcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcclxuICAgIGlmIChicmFuZEZpbHRlcikge1xyXG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2JyYW5kL3dvbWVuYCwge1xyXG4gICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0IHByb2R1Y3RzIGZvciBtZW4gLSBvcHRpb25hbCBjYXRlZ29yaWVzICYgYnJhbmQgcXVlcnkgcGFyYW1zXHJcblxyXG4gIGdldE1wcm9kdWN0c0ZpbHRlcmVkQnlDYXRlZ29yeUFuZEJyYW5kKFxyXG4gICAgY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdLFxyXG4gICAgYnJhbmRGaWx0ZXI/OiBzdHJpbmdcclxuICApIHtcclxuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xyXG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYnJhbmRGaWx0ZXIpIHtcclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZEZpbHRlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxyXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQtYW5kLWNhdGVnb3J5L21lbmAsXHJcbiAgICAgIHtcclxuICAgICAgICBwYXJhbXM6IHBhcmFtcyxcclxuICAgICAgfVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8vIEdldCBwcm9kdWN0cyBmb3Igd29tZW4gLSBvcHRpb25hbCBjYXRlZ29yaWVzICYgYnJhbmQgcXVlcnkgcGFyYW1zXHJcblxyXG4gIGdldFdwcm9kdWN0c0ZpbHRlcmVkQnlDYXRlZ29yeUFuZEJyYW5kKFxyXG4gICAgY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdLFxyXG4gICAgYnJhbmRGaWx0ZXI/OiBzdHJpbmdcclxuICApIHtcclxuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xyXG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoYnJhbmRGaWx0ZXIpIHtcclxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZEZpbHRlcik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxyXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQtYW5kLWNhdGVnb3J5L3dvbWVuYCxcclxuICAgICAgeyBwYXJhbXM6IHBhcmFtcyB9XHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgLy8gR2V0IGFsbCBwcm9kdWN0cyBmaWx0ZXJlZCBieSBicmFuZCBvbmx5LlxyXG5cclxuICBnZXRQcm9kdWN0c0J5QnJhbmQoYnJhbmRJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vYnJhbmQvJHticmFuZElkfWApO1xyXG4gIH1cclxuXHJcbiAgZ2V0V1Byb2R1Y3RzQnlCcmFuZChicmFuZElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihcclxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vYnJhbmQvd29tZW4tcHJvZHVjdHMvJHticmFuZElkfWBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBnZXRQcm9kdWN0KHByb2R1Y3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzPiB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjM+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdElkfWApO1xyXG4gICAgcmV0dXJuIHJlc3BvbnNlXHJcbiAgfVxyXG5cclxuICBnZXRQcm9kdWN0Mihwcm9kdWN0SWQ6IHN0cmluZyk6IE9ic2VydmFibGU8YW55PiB7XHJcbiAgICBsZXQgcmVzcG9uc2UgPSB0aGlzLmh0dHAuZ2V0PGFueT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0SWR9YCk7XHJcbiAgICByZXR1cm4gcmVzcG9uc2VcclxuICB9XHJcblxyXG5cclxuICBnZXRQcm9kdWN0QnlOYW1lKHByb2ROYW1lOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihcclxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vcHJvZG5hbWUvJHtwcm9kTmFtZX1gXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgY3JlYXRlUHJvZHVjdChwcm9kdWN0RGF0YTogRm9ybURhdGEpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucG9zdDxQcm9kdWN0MTIzPih0aGlzLmFwaVVybFByb2R1Y3RzLCBwcm9kdWN0RGF0YSk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVQcm9kdWN0KHByb2R1Y3REYXRhOiBGb3JtRGF0YSwgcHJvZHVjdGlkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAucHV0PFByb2R1Y3QxMjM+KFxyXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS8ke3Byb2R1Y3RpZH1gLFxyXG4gICAgICBwcm9kdWN0RGF0YVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVByb2R1Y3RXaXRoVmFyaWFudChcclxuICAgIHByb2R1Y3REYXRhOiBGb3JtRGF0YSxcclxuICAgIHByb2R1Y3RpZDogc3RyaW5nXHJcbiAgKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxQcm9kdWN0MTIzPihcclxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0aWR9L2FkZC92YXJpYW50YCxcclxuICAgICAgcHJvZHVjdERhdGFcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBkZWxldGVQcm9kdWN0KHByb2R1Y3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAuZGVsZXRlPGFueT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vJHtwcm9kdWN0SWR9YCk7XHJcbiAgfVxyXG5cclxuICBnZXRQcm9kdWN0c0NvdW50KCk6IE9ic2VydmFibGU8bnVtYmVyPiB7XHJcbiAgICByZXR1cm4gdGhpcy5odHRwXHJcbiAgICAgIC5nZXQ8bnVtYmVyPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvY291bnRgKVxyXG4gICAgICAucGlwZShtYXAoKG9iamVjdFZhbHVlOiBhbnkpID0+IG9iamVjdFZhbHVlLnByb2R1Y3RDb3VudCkpO1xyXG4gIH1cclxuXHJcbiAgZ2V0RmVhdHVyZWRQcm9kdWN0cygpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvZmVhdHVyZWQvYCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgZ2V0RmVhdHVyZWRQcm9kdWN0c0J5QnJhbmQoYnJhbmQ6c3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcclxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2ZlYXR1cmVkL2AgKyBicmFuZCk7XHJcbiAgfVxyXG5cclxuXHJcbiAgYWRkR2FsbGVyeShwcm9kdWN0SWQ6IHN0cmluZywgZ2FsbGVyeUZvcm1EYXRhOiBGb3JtRGF0YSkgOiBPYnNlcnZhYmxlPGFueT57XHJcbiAgICBjb25zb2xlLmxvZyhcInNlbmRpbmcgcG9zdCByZXF1ZXN0LCBhZGRpbmcgdG8gZ2FsbGVyeSFcIik7XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dhbGxlcnktaW1hZ2VzLyR7cHJvZHVjdElkfWAsIGdhbGxlcnlGb3JtRGF0YSk7XHJcblxyXG4gIH1cclxufVxyXG4iXX0=