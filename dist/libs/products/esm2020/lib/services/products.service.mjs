import { Inject, Injectable } from '@angular/core';
import { HttpClient, HttpParams } from '@angular/common/http';
import { map } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common/http";
let categoryMap = new Map();
let brandMap = new Map();
export class ProductsService {
    constructor(http, environment) {
        this.http = http;
        this.environment = environment;
        this.apiUrlProducts = this.environment.apiURL + 'products';
        categoryMap.set("camicie", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("camice", "61ab7dbaf6364e38a5b6297b");
        categoryMap.set("polo", "61abf4a257450fc2517488f0");
        categoryMap.set("pantaloni", "61b631af0d7e33d82b524c10");
        categoryMap.set("giacche", "61bdddff2ddc4a8c13df4a17");
        categoryMap.set("felpe", "61bdf809872350f840c8979d");
        categoryMap.set("felpa", "61bdf809872350f840c8979d");
        categoryMap.set("maglioni", "61e1a62d81572bb64bd8d73b");
        categoryMap.set("gilet", "61e7cdc42eedad9135296d50");
        categoryMap.set("sneakers", "624ac34e9a3fb4d0bf04edd2");
        categoryMap.set("t-shirt", "624ac784503abba399845265");
        categoryMap.set("t-shirt ml", "624ac784503abba399845265");
        categoryMap.set("giubbotti", "624ac7f7503abba39984526d");
        categoryMap.set("giubbotto", "624ac7f7503abba39984526d");
        categoryMap.set("cinture", "632eb741544addd6ea6c2bdd");
        categoryMap.set("scarpe", "632eb754544addd6ea6c2be0");
        categoryMap.set("cappotti", "63b67f2e8d14123abed8abde");
        categoryMap.set("bermuda", "");
        categoryMap.set("jeans", "632eb762544addd6ea6c2be3");
        brandMap.set("blauer", "6213c7889309de960180da4a");
        brandMap.set("old river", "6213c89e9309de960180da4d");
        brandMap.set("colmar", "62167bd1cba8a1e0d9c1af88");
        brandMap.set("ea7", "62189efe1d62386cc22525b6");
        brandMap.set("fred perry", "62189f1e1d62386cc22525b9");
        brandMap.set("kway", "62189f371d62386cc22525bc");
        brandMap.set("lacoste", "62189f481d62386cc22525bf");
        brandMap.set("murphy&nye", "62189f7d1d62386cc22525c2");
        brandMap.set("peninsula", "62189f981d62386cc22525c5");
        brandMap.set("saucony", "62189fad1d62386cc22525c8");
        brandMap.set("sundek", "62189fbb1d62386cc22525cb");
        brandMap.set("barbour", "632e05f3b8c567de5ea83669");
        brandMap.set("ciesse", "636b57e2506ba65e593baa81");
        brandMap.set("husky", "636b57f3506ba65e593baa84");
        brandMap.set("husky fall", "636b57f3506ba65e593baa84");
        brandMap.set("canadiens", "636b5806506ba65e593baa87");
    }
    // BASIC
    // Get all products in the database - optional category query params
    getProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(this.apiUrlProducts, { params: params });
    }
    getFilteredProducts(brand, category, sex, taglie) {
        console.log("cerco con questi parametri-> brand = " + brand + " caetgory = + " + category + " sex = " + sex);
        let params = new HttpParams();
        if (brand != null && brand[0] != null && brand[0].length <= 9) {
            let objBrand;
            objBrand = [];
            brand.forEach(x => objBrand.push(brandMap.get(x)));
            params = params.append('brand', objBrand.join(','));
            console.log(params);
        }
        if (brand != null && brand[0] != null && brand[0].length > 9) {
            params = params.append('brand', brand.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length <= 9) {
            let objCategory;
            objCategory = [];
            category.forEach(x => objCategory.push(categoryMap.get(x)));
            params = params.append('category', objCategory.join(','));
            console.log(params);
        }
        if (category != null && category[0] != null && category[0].length > 9) {
            params = params.append('category', category.join(','));
            console.log(params);
        }
        if (sex) {
            params = params.append('sex', sex.join(','));
        }
        if (taglie) {
            params = params.append('taglie', taglie.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/filteredProducts`, { params: params });
    }
    // SEX FILTER
    // Get products for men - optional categories query params
    getMProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
            console.log(params);
        }
        return this.http.get(`${this.apiUrlProducts}/get/men-prods`, {
            params: params,
        });
    }
    // Get products for women - optional categories query params
    getWProducts(categoriesFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        return this.http.get(`${this.apiUrlProducts}/get/women-prods`, {
            params: params,
        });
    }
    getAllProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/all`, {
            params: params,
        });
    }
    getAllMProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/men`, {
            params: params,
        });
    }
    getAllWProductsByBrand(brandFilter) {
        let params = new HttpParams();
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand/women`, {
            params: params,
        });
    }
    // Get products for men - optional categories & brand query params
    getMproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/men`, {
            params: params,
        });
    }
    // Get products for women - optional categories & brand query params
    getWproductsFilteredByCategoryAndBrand(categoriesFilter, brandFilter) {
        let params = new HttpParams();
        if (categoriesFilter) {
            params = params.append('categories', categoriesFilter.join(','));
        }
        if (brandFilter) {
            params = params.append('brand', brandFilter);
        }
        return this.http.get(`${this.apiUrlProducts}/get/brand-and-category/women`, { params: params });
    }
    // Get all products filtered by brand only.
    getProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/${brandId}`);
    }
    getWProductsByBrand(brandId) {
        return this.http.get(`${this.apiUrlProducts}/brand/women-products/${brandId}`);
    }
    getProduct(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProduct2(productId) {
        let response = this.http.get(`${this.apiUrlProducts}/${productId}`);
        return response;
    }
    getProductByName(prodName) {
        return this.http.get(`${this.apiUrlProducts}/prodname/${prodName}`);
    }
    getProductById(prodId) {
        return this.http.get(`${this.apiUrlProducts}/prodid/${prodId}`);
    }
    createProduct(productData) {
        return this.http.post(this.apiUrlProducts, productData);
    }
    updateProduct(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}`, productData);
    }
    updateProductWithVariant(productData, productid) {
        return this.http.put(`${this.apiUrlProducts}/${productid}/add/variant`, productData);
    }
    deleteProduct(productId) {
        return this.http.delete(`${this.apiUrlProducts}/${productId}`);
    }
    getProductsCount() {
        return this.http
            .get(`${this.apiUrlProducts}/get/count`)
            .pipe(map((objectValue) => objectValue.productCount));
    }
    getFeaturedProducts() {
        return this.http.get(`${this.apiUrlProducts}/get/featured/`);
    }
    getFeaturedProductsByBrand(brand, sex) {
        let params = new HttpParams();
        console.log("sex = " + sex);
        params = params.append("sex", sex);
        console.log("params = " + JSON.stringify(params));
        return this.http.get(`${this.apiUrlProducts}/get/featured/` + brand, { params: params });
    }
    addGallery(productId, galleryFormData) {
        console.log("sending post request, adding to gallery!");
        return this.http.post(`${this.apiUrlProducts}/gallery-images/${productId}`, galleryFormData);
    }
}
ProductsService.ɵfac = function ProductsService_Factory(t) { return new (t || ProductsService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject('environment')); };
ProductsService.ɵprov = /*@__PURE__*/ i0.ɵɵdefineInjectable({ token: ProductsService, factory: ProductsService.ɵfac, providedIn: 'root' });
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && i0.ɵsetClassMetadata(ProductsService, [{
        type: Injectable,
        args: [{
                providedIn: 'root',
            }]
    }], function () { return [{ type: i1.HttpClient }, { type: undefined, decorators: [{
                type: Inject,
                args: ['environment']
            }] }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJvZHVjdHMuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvcHJvZHVjdHMvc3JjL2xpYi9zZXJ2aWNlcy9wcm9kdWN0cy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFFOUQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7QUFHckMsSUFBSSxXQUFXLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFDM0MsSUFBSSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQWlCLENBQUM7QUFLeEMsTUFBTSxPQUFPLGVBQWU7SUFLMUIsWUFBb0IsSUFBZ0IsRUFBeUIsV0FBVztRQUFwRCxTQUFJLEdBQUosSUFBSSxDQUFZO1FBQ2xDLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLEdBQUcsVUFBVSxDQUFDO1FBRTNELFdBQVcsQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDdkQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN0RCxXQUFXLENBQUMsR0FBRyxDQUFDLE1BQU0sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3BELFdBQVcsQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLDBCQUEwQixDQUFDLENBQUM7UUFDekQsV0FBVyxDQUFDLEdBQUcsQ0FBQyxTQUFTLEVBQUUsMEJBQTBCLENBQUMsQ0FBQztRQUN2RCxXQUFXLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO1FBQ3JELFdB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QUFHLElBQUksQ0FBQyxjQUFjLG1CQUFtQixTQUFTLEVBQUUsRUFBRSxlQUFlLENBQUMsQ0FBQztJQUUvRixDQUFDOzs4RUE3U1UsZUFBZSwwQ0FLb0IsYUFBYTtxRUFMaEQsZUFBZSxXQUFmLGVBQWUsbUJBRmQsTUFBTTt1RkFFUCxlQUFlO2NBSDNCLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7c0JBTXdDLE1BQU07dUJBQUMsYUFBYSIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwUGFyYW1zIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUHJvZHVjdDEyMyB9IGZyb20gJy4uL21vZGVscy9wcm9kdWN0MTIzJztcblxubGV0IGNhdGVnb3J5TWFwID0gbmV3IE1hcDxzdHJpbmcsc3RyaW5nPigpO1xubGV0IGJyYW5kTWFwID0gbmV3IE1hcDxzdHJpbmcsc3RyaW5nPigpO1xuXG5ASW5qZWN0YWJsZSh7XG4gIHByb3ZpZGVkSW46ICdyb290Jyxcbn0pXG5leHBvcnQgY2xhc3MgUHJvZHVjdHNTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBlbnZpcm9ubWVudDtcbiAgcHJpdmF0ZSBhcGlVcmxQcm9kdWN0cztcblxuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgaHR0cDogSHR0cENsaWVudCwgQEluamVjdCgnZW52aXJvbm1lbnQnKSBlbnZpcm9ubWVudCkge1xuICAgIHRoaXMuZW52aXJvbm1lbnQgPSBlbnZpcm9ubWVudDtcbiAgICB0aGlzLmFwaVVybFByb2R1Y3RzID0gdGhpcy5lbnZpcm9ubWVudC5hcGlVUkwgKyAncHJvZHVjdHMnO1xuXG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiY2FtaWNpZVwiLCBcIjYxYWI3ZGJhZjYzNjRlMzhhNWI2Mjk3YlwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJjYW1pY2VcIiwgXCI2MWFiN2RiYWY2MzY0ZTM4YTViNjI5N2JcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwicG9sb1wiLCBcIjYxYWJmNGEyNTc0NTBmYzI1MTc0ODhmMFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJwYW50YWxvbmlcIiwgXCI2MWI2MzFhZjBkN2UzM2Q4MmI1MjRjMTBcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2lhY2NoZVwiLCBcIjYxYmRkZGZmMmRkYzRhOGMxM2RmNGExN1wiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJmZWxwZVwiLCBcIjYxYmRmODA5ODcyMzUwZjg0MGM4OTc5ZFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJmZWxwYVwiLCBcIjYxYmRmODA5ODcyMzUwZjg0MGM4OTc5ZFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJtYWdsaW9uaVwiLCBcIjYxZTFhNjJkODE1NzJiYjY0YmQ4ZDczYlwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJnaWxldFwiLCBcIjYxZTdjZGM0MmVlZGFkOTEzNTI5NmQ1MFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJzbmVha2Vyc1wiLCBcIjYyNGFjMzRlOWEzZmI0ZDBiZjA0ZWRkMlwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJ0LXNoaXJ0XCIsIFwiNjI0YWM3ODQ1MDNhYmJhMzk5ODQ1MjY1XCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcInQtc2hpcnQgbWxcIiwgXCI2MjRhYzc4NDUwM2FiYmEzOTk4NDUyNjVcIik7XG4gICAgY2F0ZWdvcnlNYXAuc2V0KFwiZ2l1YmJvdHRpXCIsIFwiNjI0YWM3Zjc1MDNhYmJhMzk5ODQ1MjZkXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImdpdWJib3R0b1wiLCBcIjYyNGFjN2Y3NTAzYWJiYTM5OTg0NTI2ZFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJjaW50dXJlXCIsIFwiNjMyZWI3NDE1NDRhZGRkNmVhNmMyYmRkXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcInNjYXJwZVwiLCBcIjYzMmViNzU0NTQ0YWRkZDZlYTZjMmJlMFwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJjYXBwb3R0aVwiLCBcIjYzYjY3ZjJlOGQxNDEyM2FiZWQ4YWJkZVwiKTtcbiAgICBjYXRlZ29yeU1hcC5zZXQoXCJiZXJtdWRhXCIsIFwiXCIpO1xuICAgIGNhdGVnb3J5TWFwLnNldChcImplYW5zXCIsIFwiNjMyZWI3NjI1NDRhZGRkNmVhNmMyYmUzXCIpO1xuXG4gICAgYnJhbmRNYXAuc2V0KFwiYmxhdWVyXCIsIFwiNjIxM2M3ODg5MzA5ZGU5NjAxODBkYTRhXCIpO1xuICAgIGJyYW5kTWFwLnNldChcIm9sZCByaXZlclwiLCBcIjYyMTNjODllOTMwOWRlOTYwMTgwZGE0ZFwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJjb2xtYXJcIiwgXCI2MjE2N2JkMWNiYThhMWUwZDljMWFmODhcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiZWE3XCIsIFwiNjIxODllZmUxZDYyMzg2Y2MyMjUyNWI2XCIpO1xuICAgIGJyYW5kTWFwLnNldChcImZyZWQgcGVycnlcIixcIjYyMTg5ZjFlMWQ2MjM4NmNjMjI1MjViOVwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJrd2F5XCIsIFwiNjIxODlmMzcxZDYyMzg2Y2MyMjUyNWJjXCIpO1xuICAgIGJyYW5kTWFwLnNldChcImxhY29zdGVcIixcIjYyMTg5ZjQ4MWQ2MjM4NmNjMjI1MjViZlwiKTtcbiAgICBicmFuZE1hcC5zZXQoXCJtdXJwaHkmbnllXCIsXCI2MjE4OWY3ZDFkNjIzODZjYzIyNTI1YzJcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwicGVuaW5zdWxhXCIsIFwiNjIxODlmOTgxZDYyMzg2Y2MyMjUyNWM1XCIpO1xuICAgIGJyYW5kTWFwLnNldChcInNhdWNvbnlcIiwgXCI2MjE4OWZhZDFkNjIzODZjYzIyNTI1YzhcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwic3VuZGVrXCIsIFwiNjIxODlmYmIxZDYyMzg2Y2MyMjUyNWNiXCIpO1xuICAgIGJyYW5kTWFwLnNldChcImJhcmJvdXJcIiwgXCI2MzJlMDVmM2I4YzU2N2RlNWVhODM2NjlcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiY2llc3NlXCIsIFwiNjM2YjU3ZTI1MDZiYTY1ZTU5M2JhYTgxXCIpO1xuICAgIGJyYW5kTWFwLnNldChcImh1c2t5XCIsIFwiNjM2YjU3ZjM1MDZiYTY1ZTU5M2JhYTg0XCIpO1xuICAgIGJyYW5kTWFwLnNldChcImh1c2t5IGZhbGxcIiwgXCI2MzZiNTdmMzUwNmJhNjVlNTkzYmFhODRcIik7XG4gICAgYnJhbmRNYXAuc2V0KFwiY2FuYWRpZW5zXCIsIFwiNjM2YjU4MDY1MDZiYTY1ZTU5M2JhYTg3XCIpO1xuICB9XG5cbiAgLy8gQkFTSUNcblxuICAvLyBHZXQgYWxsIHByb2R1Y3RzIGluIHRoZSBkYXRhYmFzZSAtIG9wdGlvbmFsIGNhdGVnb3J5IHF1ZXJ5IHBhcmFtc1xuXG4gIGdldFByb2R1Y3RzKGNhdGVnb3JpZXNGaWx0ZXI/OiBzdHJpbmdbXSk6IE9ic2VydmFibGU8UHJvZHVjdDEyM1tdPiB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2NhdGVnb3JpZXMnLCBjYXRlZ29yaWVzRmlsdGVyLmpvaW4oJywnKSk7XG4gICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KHRoaXMuYXBpVXJsUHJvZHVjdHMsIHsgcGFyYW1zOiBwYXJhbXMgfSk7XG4gIH1cblxuXG5cbiAgZ2V0RmlsdGVyZWRQcm9kdWN0cyhicmFuZD86IHN0cmluZyBbXSwgY2F0ZWdvcnk/OnN0cmluZ1tdLCBzZXg/OiBzdHJpbmdbXSwgdGFnbGllPzogc3RyaW5nW10pOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjNbXT4ge1xuXG4gICAgXG4gICAgY29uc29sZS5sb2coXCJjZXJjbyBjb24gcXVlc3RpIHBhcmFtZXRyaS0+IGJyYW5kID0gXCIgKyBicmFuZCArIFwiIGNhZXRnb3J5ID0gKyBcIiArIGNhdGVnb3J5ICsgXCIgc2V4ID0gXCIgKyBzZXgpXG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGJyYW5kICE9IG51bGwgJiYgYnJhbmRbMF0hPSBudWxsICYmIGJyYW5kWzBdLmxlbmd0aCA8PSA5KSB7XG4gICAgICBsZXQgb2JqQnJhbmQ6IHN0cmluZ1tdXG4gICAgICBvYmpCcmFuZCA9IFtdO1xuXG4gICAgICBicmFuZC5mb3JFYWNoKHggPT4gb2JqQnJhbmQucHVzaChicmFuZE1hcC5nZXQoeCkpKTtcblxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBvYmpCcmFuZC5qb2luKCcsJykpO1xuXG4gICAgICBjb25zb2xlLmxvZyhwYXJhbXMpO1xuICAgIH1cbiAgICBpZiAoYnJhbmQgIT0gbnVsbCAmJiBicmFuZFswXSE9IG51bGwgJiYgYnJhbmRbMF0ubGVuZ3RoID4gOSkge1xuICAgICAgXG5cbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2JyYW5kJywgYnJhbmQuam9pbignLCcpKTtcbiAgICBcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuXG4gICAgaWYgKGNhdGVnb3J5ICE9IG51bGwgJiYgY2F0ZWdvcnlbMF0hPSBudWxsICYmIGNhdGVnb3J5WzBdLmxlbmd0aCA8PSA5KSB7XG4gICAgICBsZXQgb2JqQ2F0ZWdvcnk6IHN0cmluZ1tdXG4gICAgICBvYmpDYXRlZ29yeSA9IFtdO1xuXG4gICAgICBjYXRlZ29yeS5mb3JFYWNoKHggPT4gb2JqQ2F0ZWdvcnkucHVzaChjYXRlZ29yeU1hcC5nZXQoeCkpKTtcblxuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcnknLCBvYmpDYXRlZ29yeS5qb2luKCcsJykpO1xuICAgIFxuICAgICAgY29uc29sZS5sb2cocGFyYW1zKTtcbiAgICB9XG5cbiAgICBpZiAoY2F0ZWdvcnkgIT0gbnVsbCAmJiBjYXRlZ29yeVswXSE9IG51bGwgJiYgY2F0ZWdvcnlbMF0ubGVuZ3RoID4gOSkge1xuICAgICAgXG5cbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2NhdGVnb3J5JywgY2F0ZWdvcnkuam9pbignLCcpKTtcbiAgICBcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuXG4gICAgaWYoc2V4KXtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ3NleCcsIHNleC5qb2luKCcsJykpO1xuICAgIH1cblxuICAgIGlmKHRhZ2xpZSl7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCd0YWdsaWUnLCB0YWdsaWUuam9pbignLCcpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2ZpbHRlcmVkUHJvZHVjdHNgLCB7IHBhcmFtczogcGFyYW1zIH0pO1xuICB9XG5cblxuXG5cbiAgLy8gU0VYIEZJTFRFUlxuXG4gIC8vIEdldCBwcm9kdWN0cyBmb3IgbWVuIC0gb3B0aW9uYWwgY2F0ZWdvcmllcyBxdWVyeSBwYXJhbXNcblxuICBnZXRNUHJvZHVjdHMoY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBpZiAoY2F0ZWdvcmllc0ZpbHRlcikge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnY2F0ZWdvcmllcycsIGNhdGVnb3JpZXNGaWx0ZXIuam9pbignLCcpKTtcbiAgICAgIGNvbnNvbGUubG9nKHBhcmFtcyk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L21lbi1wcm9kc2AsIHtcbiAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgIH0pO1xuICB9XG5cbiAgLy8gR2V0IHByb2R1Y3RzIGZvciB3b21lbiAtIG9wdGlvbmFsIGNhdGVnb3JpZXMgcXVlcnkgcGFyYW1zXG5cbiAgZ2V0V1Byb2R1Y3RzKGNhdGVnb3JpZXNGaWx0ZXI/OiBzdHJpbmdbXSkge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGlmIChjYXRlZ29yaWVzRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yaWVzJywgY2F0ZWdvcmllc0ZpbHRlci5qb2luKCcsJykpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC93b21lbi1wcm9kc2AsIHtcbiAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0QWxsUHJvZHVjdHNCeUJyYW5kKGJyYW5kRmlsdGVyPzogc3RyaW5nKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQvYWxsYCwge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgfSk7XG4gIH1cblxuICBnZXRBbGxNUHJvZHVjdHNCeUJyYW5kKGJyYW5kRmlsdGVyPzogc3RyaW5nKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQvbWVuYCwge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgfSk7XG4gIH1cbiAgZ2V0QWxsV1Byb2R1Y3RzQnlCcmFuZChicmFuZEZpbHRlcj86IHN0cmluZykge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGlmIChicmFuZEZpbHRlcikge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZEZpbHRlcik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vZ2V0L2JyYW5kL3dvbWVuYCwge1xuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgfSk7XG4gIH1cblxuICAvLyBHZXQgcHJvZHVjdHMgZm9yIG1lbiAtIG9wdGlvbmFsIGNhdGVnb3JpZXMgJiBicmFuZCBxdWVyeSBwYXJhbXNcblxuICBnZXRNcHJvZHVjdHNGaWx0ZXJlZEJ5Q2F0ZWdvcnlBbmRCcmFuZChcbiAgICBjYXRlZ29yaWVzRmlsdGVyPzogc3RyaW5nW10sXG4gICAgYnJhbmRGaWx0ZXI/OiBzdHJpbmdcbiAgKSB7XG4gICAgbGV0IHBhcmFtcyA9IG5ldyBIdHRwUGFyYW1zKCk7XG4gICAgaWYgKGNhdGVnb3JpZXNGaWx0ZXIpIHtcbiAgICAgIHBhcmFtcyA9IHBhcmFtcy5hcHBlbmQoJ2NhdGVnb3JpZXMnLCBjYXRlZ29yaWVzRmlsdGVyLmpvaW4oJywnKSk7XG4gICAgfVxuXG4gICAgaWYgKGJyYW5kRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdicmFuZCcsIGJyYW5kRmlsdGVyKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihcbiAgICAgIGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9icmFuZC1hbmQtY2F0ZWdvcnkvbWVuYCxcbiAgICAgIHtcbiAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8vIEdldCBwcm9kdWN0cyBmb3Igd29tZW4gLSBvcHRpb25hbCBjYXRlZ29yaWVzICYgYnJhbmQgcXVlcnkgcGFyYW1zXG5cbiAgZ2V0V3Byb2R1Y3RzRmlsdGVyZWRCeUNhdGVnb3J5QW5kQnJhbmQoXG4gICAgY2F0ZWdvcmllc0ZpbHRlcj86IHN0cmluZ1tdLFxuICAgIGJyYW5kRmlsdGVyPzogc3RyaW5nXG4gICkge1xuICAgIGxldCBwYXJhbXMgPSBuZXcgSHR0cFBhcmFtcygpO1xuICAgIGlmIChjYXRlZ29yaWVzRmlsdGVyKSB7XG4gICAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKCdjYXRlZ29yaWVzJywgY2F0ZWdvcmllc0ZpbHRlci5qb2luKCcsJykpO1xuICAgIH1cblxuICAgIGlmIChicmFuZEZpbHRlcikge1xuICAgICAgcGFyYW1zID0gcGFyYW1zLmFwcGVuZCgnYnJhbmQnLCBicmFuZEZpbHRlcik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjNbXT4oXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvYnJhbmQtYW5kLWNhdGVnb3J5L3dvbWVuYCxcbiAgICAgIHsgcGFyYW1zOiBwYXJhbXMgfVxuICAgICk7XG4gIH1cblxuICAvLyBHZXQgYWxsIHByb2R1Y3RzIGZpbHRlcmVkIGJ5IGJyYW5kIG9ubHkuXG5cbiAgZ2V0UHJvZHVjdHNCeUJyYW5kKGJyYW5kSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8UHJvZHVjdDEyM1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9icmFuZC8ke2JyYW5kSWR9YCk7XG4gIH1cblxuICBnZXRXUHJvZHVjdHNCeUJyYW5kKGJyYW5kSWQ6IHN0cmluZyk6IE9ic2VydmFibGU8UHJvZHVjdDEyM1tdPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihcbiAgICAgIGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2JyYW5kL3dvbWVuLXByb2R1Y3RzLyR7YnJhbmRJZH1gXG4gICAgKTtcbiAgfVxuXG4gIGdldFByb2R1Y3QocHJvZHVjdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcbiAgICBsZXQgcmVzcG9uc2UgPSB0aGlzLmh0dHAuZ2V0PFByb2R1Y3QxMjM+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdElkfWApO1xuICAgIHJldHVybiByZXNwb25zZVxuICB9XG5cbiAgZ2V0UHJvZHVjdDIocHJvZHVjdElkOiBzdHJpbmcpOiBPYnNlcnZhYmxlPGFueT4ge1xuICAgIGxldCByZXNwb25zZSA9IHRoaXMuaHR0cC5nZXQ8YW55PihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS8ke3Byb2R1Y3RJZH1gKTtcbiAgICByZXR1cm4gcmVzcG9uc2VcbiAgfVxuXG5cbiAgZ2V0UHJvZHVjdEJ5TmFtZShwcm9kTmFtZTogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vcHJvZG5hbWUvJHtwcm9kTmFtZX1gXG4gICAgKTtcbiAgfVxuXG4gIGdldFByb2R1Y3RCeUlkKHByb2RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KFxuICAgICAgYCR7dGhpcy5hcGlVcmxQcm9kdWN0c30vcHJvZGlkLyR7cHJvZElkfWBcbiAgICApO1xuICB9XG5cbiAgY3JlYXRlUHJvZHVjdChwcm9kdWN0RGF0YTogRm9ybURhdGEpOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnBvc3Q8UHJvZHVjdDEyMz4odGhpcy5hcGlVcmxQcm9kdWN0cywgcHJvZHVjdERhdGEpO1xuICB9XG5cbiAgdXBkYXRlUHJvZHVjdChwcm9kdWN0RGF0YTogRm9ybURhdGEsIHByb2R1Y3RpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzPiB7XG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wdXQ8UHJvZHVjdDEyMz4oXG4gICAgICBgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS8ke3Byb2R1Y3RpZH1gLFxuICAgICAgcHJvZHVjdERhdGFcbiAgICApO1xuICB9XG5cbiAgdXBkYXRlUHJvZHVjdFdpdGhWYXJpYW50KFxuICAgIHByb2R1Y3REYXRhOiBGb3JtRGF0YSxcbiAgICBwcm9kdWN0aWQ6IHN0cmluZ1xuICApOiBPYnNlcnZhYmxlPFByb2R1Y3QxMjM+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLnB1dDxQcm9kdWN0MTIzPihcbiAgICAgIGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdGlkfS9hZGQvdmFyaWFudGAsXG4gICAgICBwcm9kdWN0RGF0YVxuICAgICk7XG4gIH1cblxuICBkZWxldGVQcm9kdWN0KHByb2R1Y3RJZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmRlbGV0ZTxhbnk+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9LyR7cHJvZHVjdElkfWApO1xuICB9XG5cbiAgZ2V0UHJvZHVjdHNDb3VudCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xuICAgIHJldHVybiB0aGlzLmh0dHBcbiAgICAgIC5nZXQ8bnVtYmVyPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvY291bnRgKVxuICAgICAgLnBpcGUobWFwKChvYmplY3RWYWx1ZTogYW55KSA9PiBvYmplY3RWYWx1ZS5wcm9kdWN0Q291bnQpKTtcbiAgfVxuXG4gIGdldEZlYXR1cmVkUHJvZHVjdHMoKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICByZXR1cm4gdGhpcy5odHRwLmdldDxQcm9kdWN0MTIzW10+KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dldC9mZWF0dXJlZC9gKTtcbiAgfVxuXG5cbiAgZ2V0RmVhdHVyZWRQcm9kdWN0c0J5QnJhbmQoYnJhbmQ6c3RyaW5nLCBzZXg6c3RyaW5nKTogT2JzZXJ2YWJsZTxQcm9kdWN0MTIzW10+IHtcbiAgICBsZXQgcGFyYW1zID0gbmV3IEh0dHBQYXJhbXMoKTtcbiAgICBjb25zb2xlLmxvZyhcInNleCA9IFwiICsgc2V4KTtcbiAgICBwYXJhbXMgPSBwYXJhbXMuYXBwZW5kKFwic2V4XCIsIHNleCk7XG4gICAgY29uc29sZS5sb2coXCJwYXJhbXMgPSBcIiArIEpTT04uc3RyaW5naWZ5KHBhcmFtcykpXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5nZXQ8UHJvZHVjdDEyM1tdPihgJHt0aGlzLmFwaVVybFByb2R1Y3RzfS9nZXQvZmVhdHVyZWQvYCArIGJyYW5kICwgeyBwYXJhbXM6IHBhcmFtcyB9KTtcbiAgfVxuXG5cbiAgYWRkR2FsbGVyeShwcm9kdWN0SWQ6IHN0cmluZywgZ2FsbGVyeUZvcm1EYXRhOiBGb3JtRGF0YSkgOiBPYnNlcnZhYmxlPGFueT57XG4gICAgY29uc29sZS5sb2coXCJzZW5kaW5nIHBvc3QgcmVxdWVzdCwgYWRkaW5nIHRvIGdhbGxlcnkhXCIpO1xuXG4gICAgcmV0dXJuIHRoaXMuaHR0cC5wb3N0KGAke3RoaXMuYXBpVXJsUHJvZHVjdHN9L2dhbGxlcnktaW1hZ2VzLyR7cHJvZHVjdElkfWAsIGdhbGxlcnlGb3JtRGF0YSk7XG5cbiAgfVxufVxuIl19